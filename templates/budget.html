<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Orçamento de Perfuração</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      font-size: 14px;
      margin: 40px;
      color: #333;
    }
    h1, h2 {
      text-align: center;
      color: #004080;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 0px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
      
    }
    th {
      background-color: #f0f0f0;
      
    }
    .section-title {
      background-color: #e6f0ff;
      padding: 6px;
      font-weight: bold;
      
    }
    .total {
      font-size: 16px;
      font-weight: bold;
      text-align: right;
      
    }
  </style>
</head>
<body>

  <h1>Orçamento de Perfuração de Poço</h1>

  <p><strong>Cliente:</strong> <span id="cliente-nome"></span><br>
  <strong>Local:</strong><span id="cliente-local"></span></p>

  <table id="tabela">
  <thead>
    <tr>
      <th style="width: 8%;">Item</th>
      <th style="width: 42%;">Descrição</th>
      <th style="width: 15%;">Quantidade</th>
      <th style="width: 15%;">Valor (R$)</th>
      <th style="width: 20%;">Valor  Total(R$)</th>
    </tr>
  </thead>
  <tbody>
    
  </tbody>
</table>
  <div class="section-title">Prospecção</div>
  <table id="prospeccao-tabela">
  <tbody>

  </tbody>
</table>

  <div class="section-title">Perfuração</div>
  <table id="perfuracao-tabela">
  <tbody>
    <!-- Linhas serão inseridas aqui pelo JS -->
  </tbody>
</table>

  <div class="section-title">Tubulação e Estrutura</div>
  <table id="estrutura-tabela">
<tbody>
    <!-- Linhas serão inseridas aqui pelo JS -->
  </tbody>
  </table>

  <div class="section-title">Instalação de equipamentos</div>
  <table id="equipamentos-tabela">
    <tbody>
    <!-- Linhas serão inseridas aqui pelo JS -->
  </tbody>
  </table>



  <div class="section-title">Documentação</div>
  <table id="documentacao-tabela">
    <tbody>
    <!-- Linhas serão inseridas aqui pelo JS -->
  </tbody>
  </table>

  <div class="section-title">Extras</div>
   
 <div class="section-title">Instalação</div>
  <ul>
    <li>✓ Instalação completa dos equipamentos</li>
    <li>✓ Testes de vazão e funcionamento</li>
    <li>✓ Aterramento elétrico de segurança</li>
  </ul>

  <ul>
    <li>✓ Reservatório: {{ extras.reservatorio }}</li>
    <li>✓ Placa de sinalização</li>
  </ul>

  <div class="section-title">Condições Comerciais</div>
  <ul>
    <li><strong>Forma de Pagamento:</strong> {{ pagamento.forma }} ({{ pagamento.entrada }}, {{ pagamento.parcelas }})</li>
    <li><strong>Prazo de Execução:</strong> {{ condicoes.prazo_execucao }}</li>
    <li><strong>Validade da Proposta:</strong> {{ condicoes.validade_proposta }}</li>
  </ul>

  <p class="total">Total estimado: <strong id="valor_calculado">R$ [valor calculado]</strong></p>

  <p><em>* Este é um orçamento estimado, sujeito a confirmação técnica no local.</em></p>

  <script>
    topicos = ["Prospeccao","Perfuracao","Estrutura","equipamentos","Instalação","Documentação","Extras"]

document.addEventListener('DOMContentLoaded', async function() {
    await fetch('./budget.json')
        .then(response => response.json())
        .then(data => {

            console.log("antes do for "+ Object.keys(data));
             for (let key in data) {
                if (Array.isArray(data[key])) {
                    console.log("a chave é" + key);
                    
                    // Exemplo: monta id da tabela igual ao nome da key
                    const tabela = document.getElementById(key + '-tabela');
                    if (!tabela) continue; // pula se não existir tabela para essa key
                    const tbody = tabela.getElementsByTagName('tbody')[0];
                    tbody.innerHTML = '';
                    data[key].forEach((item, idx) => {
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
                            <td style="width: 8%;">${idx + 1}</td>
                            <td style="width: 42%;">${item.descricao ?? '-'}</td>
                            <td style="width: 15%;">${item.quantidade ?? '-'}</td>
                            <td style="width: 15%;">${item.valor ?? '-'}</td>
                            <td style="width: 20%;" class="total">${item.valor * item.quantidade ?? '-'}</td>
                        `;
                        tbody.appendChild(tr);
                    });
                }
            }

    
        });
        totalizacao();
})

function totalizacao() {
     let somaTotal = 0;
document.querySelectorAll(".total").forEach(e =>{
     const valor = Number(e.textContent.replace(/[^\d.,-]/g, '').replace(',', '.'));
    if (!isNaN(valor)) somaTotal += valor;
});
document.querySelector("#valor_calculado").textContent = somaTotal
}
  </script>

</body>
</html>
 